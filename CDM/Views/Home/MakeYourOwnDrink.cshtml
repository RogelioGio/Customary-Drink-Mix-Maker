@{
    ViewBag.Title = "Make Your Own Drink";
}

<style>
    .center {
        margin: 0;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: solid, 1px;
        border-radius: 15px;
        padding: 100px;
    }
</style>

<div class="center">
<h2>Make Your Own Drink</h2>

<form id="drinkForm" method="post" action="/Home/MakeYourOwnDrink">
    <div>
        <label for="BaseDrink">Base drink</label>
        <select id="BaseDrink" name="BaseDrink">
            <option value="Beer">Beer - 35</option>
            <option value="Gin">Gin - 75</option>
            <option value="Wine">Wine - 115</option>
            <option value="Sake">Sake - 150</option>
            <option value="Whiskey">Whiskey - 185</option>
        </select>
    </div>
    <div>
        <label>Size</label><br />
        <input type="radio" id="SizeSmall" name="Size" value="Small" onchange="updateLayers(3)" /> Small - (8oz)
        <input type="radio" id="SizeMedium" name="Size" value="Medium" onchange="updateLayers(4)" /> Medium - (16oz)
        <input type="radio" id="SizeLarge" name="Size" value="Large" onchange="updateLayers(5)" /> Large - (22oz)
    </div>
    <div id="layersContainer"></div>

    <div>
        

        <button type="button" onclick="window.location='@Url.Action("Index", "Home")'">Back</button>
        <button type="submit" onclick="drinkResponsibly()">Create Drink</button>
    </div>
</form>
</div>
<script>
    const shotCosts = {
        None: 0,
        Beer: 10,
        Gin: 20,
        Wine: 30,
        Sake: 40,
        Whiskey: 50
    };

    function updateLayers(count) {
        const container = document.getElementById('layersContainer');
        container.innerHTML = '';

        for (let i = 0; i < count; i++) {
            const layerDiv = document.createElement('div');
            layerDiv.innerHTML =
                `<label>Layer ${i + 1}</label>
            <select name="Layers[${i}].Shot">
                ${Object.entries(shotCosts).map(([key, value]) =>
                    `<option value="${key}">${key} - ${value}</option>`
                ).join('')}
            </select>
            <input type="number" name="Layers[${i}].Percentage" placeholder="Quantity" value="1" min="0" max="100" onchange="validatePercentages()" />
            <button type="button" onclick="addValue(${i}, 10)">+10</button>
            <button type="button" onclick="addValue(${i}, 1)">+1</button>
            <button type="button" onclick="subtractValue(${i}, 1)">-1</button>
            <button type="button" onclick="subtractValue(${i}, 10)">-10</button>
        `;
            container.appendChild(layerDiv);
        }
    }

    function addValue(index, valueToAdd) {
        const input = document.querySelector(`input[name="Layers[${index}].Percentage"]`);
        input.value = parseInt(input.value || 0, 10) + valueToAdd;
        validatePercentages();
    }

    function subtractValue(index, valueToSubtract) {
        const input = document.querySelector(`input[name="Layers[${index}].Percentage"]`);
        input.value = parseInt(input.value || 0, 10) - valueToSubtract;
        input.value = newValue < 0 ? 0 : newValue;
        validatePercentages();
    }

    function validatePercentages() {
        const percentageInputs = document.querySelectorAll('input[name^="Layers"][name$=".Percentage"]');
        let totalPercentage = 0;
        percentageInputs.forEach(input => {
            const value = parseFloat(input.value);
            if (!isNaN(value)) {
                totalPercentage += value;
            }
        });

        if (totalPercentage > 100) {
            alert('The total percentage exceeds 100%. Please adjust the values.');
        }
    }

    document.getElementById('drinkForm').addEventListener('submit', function (event) {
        const percentageInputs = document.querySelectorAll('input[name^="Layers"][name$=".Percentage"]');
        let totalPercentage = 0;
        percentageInputs.forEach(input => {
            const value = parseFloat(input.value);
            if (!isNaN(value)) {
                totalPercentage += value;
            }
        });

        if (totalPercentage > 100) {
            event.preventDefault();
            alert('The total percentage exceeds 100%. Please adjust the values before submitting.');
        }
    });

    function drinkResponsibly() {
        alert("Please remember that we can't be held responsible for the effects of mixing our alcohol beverages with other substances. Your safety matters to us, so please consume responsibly and be mindful of the choices you make. Cheers, and stay safe!");
    }
</script>
