@model CDM.Models.CustomDrinkModel
@{
    ViewBag.Title = "Make Your Own Drink";
}
<link href="https://cdn.jsdelivr.net/npm/fastbootstrap@2.2.0/dist/css/fastbootstrap.min.css" rel="stylesheet" integrity="sha256-V6lu+OdYNKTKTsVFBuQsyIlDiRWiOmtC8VQ8Lzdm2i4=" crossorigin="anonymous">
<style>
    main {
        font-family: "Jost", sans-serif;
        font-optical-sizing: auto;
        font-weight: 400;
        font-style: normal;
        overflow: hidden;
    }

    article {
        padding: 2vw;
        overflow: hidden;
    }

        article .header {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

            article .header img {
                height: 20vh;
            }

            article .header h1 {
                margin-left: 2vw;
            }

        article form {
            padding: 0 3vw;
        }

            article form .Base h2 {
                margin: 3vh 0;
            }

            article form .Base ul {
                list-style: none;
                display: flex;
                padding: 0px;
                gap: 2vw
            }

                article form .Base ul li .div {
                    border: solid, 1px;
                    border-radius: 1vw;
                    display: flex;
                    flex-direction: column;
                    width: 15vw;
                    height: 40vh;
                    padding: 3vh;
                    cursor: pointer;
                    gap: 2vh
                }

                    article form .Base ul li .div:hover {
                        border: solid, 2px, rgba(0, 48, 73);
                        background-color: rgba(0, 48, 73);
                        color: white;
                    }

                    article form .Base ul li .div #id {
                        opacity: 0;
                        height: 0;
                        width: 0;
                    }

                    article form .Base ul li .div img {
                        height: 25vh;
                    }

                    article form .Base ul li .div:has(input[type=radio]:checked) {
                        border: solid, 2px, rgba(0, 48, 73);
                        background-color: rgba(0, 48, 73);
                        color: white;
                    }

            article form .DrinkSize h2 {
                margin: 3vh 0;
            }

            article form .DrinkSize label {
                border: solid, 1px;
                border-radius: 1vw;
                align-items: center;
                display: flex;
                width: 15vw;
                padding: 3vh;
                cursor: pointer;
                font-size: large;
            }

            article form .DrinkSize .sizeOption {
                display: flex;
                gap: 2vw;
            }

                article form .DrinkSize .sizeOption label:hover {
                    border: solid, 2px, rgba(0, 48, 73);
                    background-color: rgba(0, 48, 73);
                    color: white;
                    fill: white;
                }

                article form .DrinkSize .sizeOption label:has(input[type=radio]:checked) {
                    border: solid, 2px, rgba(0, 48, 73);
                    background-color: rgba(0, 48, 73);
                    color: white;
                    fill: white;
                }


                article form .DrinkSize .sizeOption .icon {
                    width: 4vw;
                    height: 100%;
                }

                article form .DrinkSize .sizeOption label input {
                    opacity: 0;
                    height: 0;
                    width: 0;
                }

            article form #layersContainer div .layerOption {
                list-style: none;
                display: flex;
                padding: 0px;
                gap: 2vw
            }

            article form #layersContainer div .layerOption .div {
                border: solid, 1px;
                border-radius: 1vw;
                display: flex;
                flex-direction: column;
                width: 15vw;
                height: 40vh;
                padding: 3vh;
                cursor: pointer;
                gap: 2vh
            }
</style>
<article>
    <section class="header">
        <img src="~/Preview.png">
        <h1>Create Your Drink</h1>
    </section>
    <form id="drinkForm" method="post" action="/Home/MakeYourOwnDrink">
        <section class="Base">
            <h2>Choose your base of your drink</h2>
            <ul>
                @foreach (var Base in Model.productList)
                {
                    <li>
                        <label class="div transition ease-in-out delay-150 -translate-y-px-hover duration-300 scale-110-hover" id="parent">
                            <img src="~/ProductAssets/@Base.imageUrlString">
                            <input type="radio" name="BaseDrink" value="@Base.Product_Name" id="id" onchange="products_addon(this, '@Base.Product_ID', '@Base.Product_Name', '@Base.Product_Price')" /> @Base.Product_Name (₱@Base.Product_Price)
                        </label>
                    </li>
                }
            </ul>
        </section>
        <section class="DrinkSize">
            <h2>Size of your drink</h2>
            <div class="sizeOption">
                <label class="transition ease-in-out delay-150 -translate-y-px-hover duration-300 scale-110-hover">
                    <box-icon name='signal-1' class="icon"></box-icon>
                    <input type="radio" id="SizeSmall" name="Size" value="Small" onchange="updateLayers(3)" /> Small<br>(8oz)
                </label>
                <label class="transition ease-in-out delay-150 -translate-y-px-hover duration-300 scale-110-hover">
                    <box-icon name='signal-2' class="icon"></box-icon>
                    <input type="radio" id="SizeMedium" name="Size" value="Medium" onchange="updateLayers(4)" /> Medium<br>(16oz)
                </label>
                <label class="transition ease-in-out delay-150 -translate-y-px-hover duration-300 scale-110-hover">
                    <box-icon name='signal-3' class="icon"></box-icon>
                    <input type="radio" id="SizeLarge" name="Size" value="Large" onchange="updateLayers(5)" /> Large<br>(22oz)
                </label>
            </div>

        </section>
        <section id="layersContainer">
        </section>
        <section class="button">
            <button type="button" onclick="window.location='@Url.Action("Index", "Home")'">Back</button>
            <button type="submit" onclick="drinkResponsibly()">Create Drink</button>
        </section>
    </form>
</article>
<script>
    const shotCosts = {
        None: 0,
        Beer: 10,
        Gin: 20,
        Wine: 30,
        Sake: 40,
        Whiskey:40
    };

    function InitProductList() {
        var items = @Html.Raw(Json.Encode(Model.productList));
        console.log(items)
    }
    InitProductList()
    function updateLayers(count) {
        const container = document.getElementById('layersContainer');
        container.innerHTML = '';


        var items = @Html.Raw(Json.Encode(Model.productList));
        let productListHTML = '';
        items.forEach(function (p) {
            productListHTML +=
            `<label class="div transition ease-in-out delay-150 -translate-y-px-hover duration-300 scale-110-hover" id="parent">
             <input type="radio" name="radiogroup"/>${p.Product_Name}
             </label>`;
        });

        for (let i = 0; i < count; i++) {
            const layerDiv = document.createElement('div');
            layerDiv.innerHTML =
                `<label>Layer ${i + 1}</label>
            <div class = "layerOption">
            ${productListHTML}
            </div>
            <input type="number" name="Layers[${i}].Percentage" placeholder="Quantity" value="1" min="0" max="100" onchange="validatePercentages()" />
            <button type="button" onclick="addValue(${i}, 10)">+10</button>
            <button type="button" onclick="addValue(${i}, 1)">+1</button>
            <button type="button" onclick="subtractValue(${i}, 1)">-1</button>
            <button type="button" onclick="subtractValue(${i}, 10)">-10</button>
        `;
            container.appendChild(layerDiv);
        }
    }

    function addValue(index, valueToAdd) {
        const input = document.querySelector(`input[name="Layers[${index}].Percentage"]`);
        input.value = parseInt(input.value || 0, 10) + valueToAdd;
        validatePercentages();
    }

    function subtractValue(index, valueToSubtract) {
        const input = document.querySelector(`input[name="Layers[${index}].Percentage"]`);
        input.value = parseInt(input.value || 0, 10) - valueToSubtract;
        input.value = newValue < 0 ? 0 : newValue;
        validatePercentages();
    }

    function validatePercentages() {
        const percentageInputs = document.querySelectorAll('input[name^="Layers"][name$=".Percentage"]');
        let totalPercentage = 0;
        percentageInputs.forEach(input => {
            const value = parseFloat(input.value);
            if (!isNaN(value)) {
                totalPercentage += value;
            }
        });

        if (totalPercentage > 100) {
            alert('The total percentage exceeds 100%. Please adjust the values.');
        }
    }

    document.getElementById('drinkForm').addEventListener('submit', function (event) {
        const percentageInputs = document.querySelectorAll('input[name^="Layers"][name$=".Percentage"]');
        let totalPercentage = 0;
        percentageInputs.forEach(input => {
            const value = parseFloat(input.value);
            if (!isNaN(value)) {
                totalPercentage += value;
            }
        });

        if (totalPercentage > 100) {
            event.preventDefault();
            alert('The total percentage exceeds 100%. Please adjust the values before submitting.');
        }
    });

    function drinkResponsibly() {
        alert("Please remember that we can't be held responsible for the effects of mixing our alcohol beverages with other substances. Your safety matters to us, so please consume responsibly and be mindful of the choices you make. Cheers, and stay safe!");
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>